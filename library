local library = {}

-- Add a proper metatable setup for the library
local libraryMetatable = {
    __index = function(self, key)
        return library[key]
    end
}

setmetatable(library, libraryMetatable)

// ... existing code ...

function library:Create(title, titleUnder)
local lib = {}
setmetatable(lib, libraryMetatable)  -- Ensure the new lib has the same metatable

lib.UI = game:GetObjects("rbxassetid://6849423853")[1]
lib.UI.Parent = game.CoreGui

// ... existing code ...

-- Fix the Click function that was causing recursion
function library:Click()
    -- Remove the recursive call
end

-- Fix the Update function to properly handle state changes
function library:Update(new, new2, new3)
    if self.table then
        self.table = new
        self.Refresh()
    elseif self.min and self.max then
        self.min = new
        self.max = new2
        self.Refresh(new3 or self.max/2, true)
    elseif self.toggle then
        if new ~= self.state then
            self.state = new
            self.Refresh()
        end
    elseif self.class == "label" then
        self.Refresh(new)
    end
end

-- Fix the ToggleUI function to properly handle UI visibility
function library:ToggleUI()
    if self.UI then
        self.UI.Enabled = not self.UI.Enabled
    end
end

-- Return the library with its metatable
return library
